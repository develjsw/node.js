### Node.js 메모리 누수 ( Memory Leak )

- 메모리 누수란 ?
  - 메모리를 할당한 후 더 이상 필요하지 않지만 GC에 의해 해제되지 않은 상태를 의미
  - 반복되면 메모리를 사용할 수 없게 되어 서버 장애가 발생할 수 있음
    ~~~
    EX)
    
    회원 1명이 회원가입을 했을 때, 정보를 생성하고 객체에 담아 전달한다.
    이때 객체의 메모리는 1KB라고 가정하자.
  
    새로운 회원 499명이 추가로 가입했고 메모리는 총 500KB 할당 되었다.
  
    일부 서비스에 불편을 느낀 사용자 100명이 회원탈퇴를 했으나, 해당 메모리는 GC에 의해 반환받지 못했다.

    이러한 상태가 반복되면 메모리 부족으로 서버가 중단될 위험이 있다.
    ~~~


- Node.js의 메모리 관리 방식
  - V8 엔진의 Garbage Collector(GC)가 메모리를 관리하며, 개발자가 직접 메모리 할당/회수를 처리하지 않아도 됨
  - 메모리 관리 방식 :
    - 메모리 할당 : Heap과 Stack 메모리를 V8 엔진에 의해 동적으로 관리
      - JavaScript 객체는 Heap에 저장됨
      - 함수 호출에 필요한 로컬 변수는 Stack에 저장됨
    - 메모리 해제 :
      - GC는 더 이상 참조되지 않는 객체를 탐지하고 메모리를 해제함
  - GC는 대부분 메모리를 자동으로 관리하지만, 참조가 남아 있는 객체는 해제하지 못함


- 메모리 누수 원인
  - `전역 변수 사용` : 전역 변수는 프로세스가 종료될 때까지 메모리에 유지됨
  - `클로저 남용` : 클로저 내에서 불필요한 참조를 유지하면 메모리가 해제되지 않음
  - `캐시 남용` : 객체나 데이터를 캐시에 저장하고 정리하지 않으면 메모리 누수가 발생할 수 있음
  - `타이머/비동기 작업 미해제` : setInterval, setTimeout이 완료되지 않고 남아 있는 경우


- 해결 방법
  - `전역 변수 최소화` : 전역 변수를 사용해야 한다면 반드시 초기화 및 해제를 관리
  - `클로저 점검` : 불필요한 참조를 줄이고, 오래된 참조는 명시적으로 `null`로 설정하여 GC가 메모리를 해제할 수 있도록 함
  - `캐시 관리` : 사용하지 않는 데이터를 삭제하고, 캐시 크기를 제한하는 정책 설정
  - `타이머 정리` : `setInterval`과 `setTimeout`은 사용 후 반드시 `clearInterval` 또는 `clearTimeout`으로 제거


- 메모리 누수 분석 방법
  - `process.memoryUsage()`: 현재 프로세스의 메모리 사용량을 바이트 단위로 확인
  - `node-inspect` 또는 `Chrome DevTools`: 메모리 스냅샷을 찍고 힙 덤프를 분석하여 메모리 누수 원인을 식별